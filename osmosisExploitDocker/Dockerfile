FROM ubuntu:22.10
#install go, build osmosis
WORKDIR /home/osmosisDOS
RUN  apt-get -y update
RUN apt-get -y upgrade && apt -y install git make wget gcc tmux build-essential ufw curl jq snapd 
RUN wget https://go.dev/dl/go1.20.6.linux-amd64.tar.gz
RUN tar -C /usr/local -xzf go1.20.6.linux-amd64.tar.gz
ENV PATH=$PATH:/usr/local/go/bin
ENV GOPATH=$HOME/go
ENV PATH=$PATH:/usr/local/go/bin:$GOPATH/bin 
RUN git clone https://github.com/osmosis-labs/osmosis.git
WORKDIR /home/osmosisDOS/osmosis
RUN git checkout tags/v16.1.0
RUN make build
RUN ln -s /home/osmosisDOS/osmosis/build/osmosisd /usr/bin/osmosisd

#install the vulnerable version of cosmovisor
WORKDIR /home/osmosisDOS/
RUN go install github.com/cosmos/cosmos-sdk/cosmovisor/cmd/cosmovisor@v0.1.0

#install vim for debugging
RUN apt -y install vim

#node start script and exploit scripts
COPY start.sh start.sh
COPY setup_osmosis.sh setup_osmosis.sh
COPY exploit.sh exploit.sh
COPY malicious_proposal.json malicious_proposal.json

#malicious update script
COPY hacker.sh hacker.sh

RUN chmod +x setup_osmosis.sh
RUN chmod +x start.sh
RUN chmod +x exploit.sh
ENTRYPOINT ["./start.sh"]
