#!/bin/bash 

RAND=$(tr -dc A-Za-z0-9 </dev/urandom | head -c 13 ; echo '') 

MAINPATH=/tmp/testnet-$RAND
HOMEPATH=$MAINPATH/daemon
echo MAINPATH: $MAINPATH

mkdir $MAINPATH 
mkdir $MAINPATH/cosmovisor/
mkdir $MAINPATH/cosmovisor/genesis
mkdir $MAINPATH/cosmovisor/genesis/bin
mkdir $HOMEPATH

echo $MAINPATH > /tmp/currentNode.txt

# Setup the daemon to run
ln /usr/local/bin/pystarport $MAINPATH/cosmovisor/genesis/bin/cronosd -s

# Add a key to the backend
echo "evidence bread stamp title slab robust room travel expire mansion share tuna evidence fork found" | cronosd keys add joe --recover --keyring-backend test --home $HOMEPATH

# Execute the command with cosmosvisor and pyport
export DAEMON_HOME=$MAINPATH 
export DAEMON_ALLOW_DOWNLOAD_BINARIES=true 
export DAEMON_NAME=cronosd
export DAEMON_RESTART_AFTER_UPGRADE=true
export UNSAFE_SKIP_BACKUP=true

mkdir $MAINPATH/data

echo $DAEMON_NAME

#pystarport serve --config /cronos/scripts/cronos-devnet.yaml
# Run with our settings to have the proper mnenmonic
cosmovisor serve --config /cronos/scripts/cronos-devnet.yaml 


